<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Diamond Analysis: Parallel Execution - The DAGwood Project Demo</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Interactive demonstration of DAG execution strategies, Rust concepts, and WASM integration">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The DAGwood Project Demo</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ciroque/the-dagwood" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ciroque/the-dagwood/edit/main/docs/demo/src/03-diamond-analysis.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="diamond-analysis-parallel-execution"><a class="header" href="#diamond-analysis-parallel-execution">Diamond Analysis: Parallel Execution</a></h1>
<h2 id="what-youll-see"><a class="header" href="#what-youll-see">What You'll See</a></h2>
<p>This demonstration showcases the classic diamond dependency pattern where multiple processors run in parallel and their results converge. You'll see true concurrent execution, metadata merging, and how the canonical payload architecture prevents race conditions.</p>
<p><strong>Key Learning Points:</strong></p>
<ul>
<li>Parallel execution with tokio async tasks</li>
<li>Canonical payload architecture (Transform vs Analyze)</li>
<li>Metadata collection and merging strategies</li>
<li>Race condition prevention in concurrent execution</li>
</ul>
<h2 id="the-demo"><a class="header" href="#the-demo">The Demo</a></h2>
<h3 id="command-line"><a class="header" href="#command-line">Command Line</a></h3>
<pre><code class="language-bash">cargo run --release -- docs/demo/configs/03-diamond-analysis.yaml "hello world"
</code></pre>
<h3 id="configuration"><a class="header" href="#configuration">Configuration</a></h3>
<pre><code class="language-yaml"># Demo 3: Diamond Analysis - Parallel Execution
# This demonstrates the classic diamond dependency pattern with parallel analysis

strategy: work_queue
failure_strategy: fail_fast

executor_options:
  max_concurrency: 4

processors:
  # Entry point: prepare the text
  - id: prepare_text
    backend: local
    impl: change_text_case_lower
    depends_on: []
    options: {}

  # Parallel analysis processors (both depend on prepare_text)
  - id: count_tokens
    backend: local
    impl: token_counter
    depends_on: [prepare_text]
    options:
      count_type: "words"

  - id: analyze_frequency
    backend: local
    impl: word_frequency_analyzer
    depends_on: [prepare_text]
    options: {}

  # Convergence point: combine results (depends on both analysis processors)
  - id: final_summary
    backend: local
    impl: prefix_suffix_adder
    depends_on: [count_tokens, analyze_frequency]
    options:
      prefix: "Analysis Complete: "
      suffix: " [END]"
</code></pre>
<p><strong>Configuration Elements:</strong></p>
<ul>
<li><strong>Strategy</strong>: <code>work_queue</code> (dependency counting algorithm)</li>
<li><strong>Failure Strategy</strong>: <code>fail_fast</code> (stop on first error)</li>
<li><strong>Concurrency</strong>: Set to 4 (enables true parallel execution)</li>
<li><strong>Diamond Pattern</strong>: <code>prepare_text ‚Üí [count_tokens, analyze_frequency] ‚Üí final_summary</code></li>
</ul>
<h3 id="expected-output"><a class="header" href="#expected-output">Expected Output</a></h3>
<p>When you run this demo, you'll see:</p>
<pre><code>üöÄ DAGwood Execution Strategy Demo
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Input: "hello world"
Config files: ["docs/demo/configs/03-diamond-analysis.yaml"]

üìã Configuration: docs/demo/configs/03-diamond-analysis.yaml
üîß Strategy: WorkQueue
‚öôÔ∏è  Max Concurrency: 4
üõ°Ô∏è  Failure Strategy: FailFast

üìä Execution Results:
‚è±Ô∏è  Execution Time: ~4ms
üî¢ Processors Executed: 4

üîÑ Processor Chain:
  1. prepare_text ‚Üí "hello world"
  2. count_tokens ‚Üí "2" (parallel)
  3. analyze_frequency ‚Üí "{\"hello\": 1, \"world\": 1}" (parallel)
  4. final_summary ‚Üí "Analysis Complete: hello world [END]"

üéØ Final Transformation:
   Input:  "hello world"
   Output: "Analysis Complete: hello world [END]"
</code></pre>
<h2 id="what-you-just-saw"><a class="header" href="#what-you-just-saw">What You Just Saw</a></h2>
<p>This demo demonstrated:</p>
<p><strong>Diamond Pattern Execution:</strong></p>
<ul>
<li>True parallel execution of <code>count_tokens</code> and <code>analyze_frequency</code></li>
<li>Convergence at <code>final_summary</code> waiting for both analysis results</li>
<li>Canonical payload preventing race conditions in parallel execution</li>
</ul>
<p><strong>Rust Concurrency Mastery:</strong></p>
<ul>
<li>Semaphore-controlled parallel task spawning</li>
<li>Arc&lt;Mutex<T>&gt; for thread-safe shared state</li>
<li>RAII permit management for resource cleanup</li>
<li>Async task coordination with tokio::spawn</li>
</ul>
<p><strong>System Architecture:</strong></p>
<ul>
<li>Transform vs Analyze processor intent separation</li>
<li>Metadata merging with collision-resistant namespacing</li>
<li>Deterministic execution regardless of completion order</li>
<li>Dependency isolation ensuring clean data flow</li>
</ul>
<h2 id="performance-analysis"><a class="header" href="#performance-analysis">Performance Analysis</a></h2>
<h3 id="parallel-speedup"><a class="header" href="#parallel-speedup">Parallel Speedup</a></h3>
<p>With <code>max_concurrency: 4</code>, the analysis processors run truly in parallel:</p>
<ul>
<li><strong>Sequential</strong>: prepare_text (1ms) + count_tokens (1ms) + analyze_frequency (1ms) + final_summary (1ms) = 4ms</li>
<li><strong>Parallel</strong>: prepare_text (1ms) + max(count_tokens, analyze_frequency) (1ms) + final_summary (1ms) = 3ms</li>
<li><strong>25% speedup</strong> from parallel execution</li>
</ul>
<h3 id="memory-efficiency"><a class="header" href="#memory-efficiency">Memory Efficiency</a></h3>
<ul>
<li><strong>Arc<ProcessorRequest></strong>: Shared input across parallel processors with reference counting</li>
<li><strong>Canonical payload</strong>: Single source of truth eliminates payload duplication</li>
<li><strong>Metadata isolation</strong>: Only relevant dependency metadata passed to each processor</li>
</ul>
<h2 id="whats-next"><a class="header" href="#whats-next">What's Next?</a></h2>
<p>In the next demo, the exploration moves to <strong>WASM integration</strong> where processors run in secure sandboxes, introducing:</p>
<ul>
<li>Cross-language processor execution</li>
<li>Memory management across WASM boundaries</li>
<li>Security isolation patterns</li>
<li>Multi-backend coordination</li>
</ul>
<hr />
<blockquote>
<p>‚ö° <strong>Performance Insight</strong>: The diamond pattern is where DAG execution shines! By running analysis processors in parallel while maintaining deterministic results, both performance and correctness are achieved - a classic challenge in distributed systems that Rust's ownership model helps solve elegantly.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="02-text-pipeline.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="04-wasm-integration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="02-text-pipeline.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="04-wasm-integration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>



    </div>
    </body>
</html>
